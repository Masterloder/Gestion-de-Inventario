necesito mejorar y optimisar mi codigo en laravel con bootstrad 5 (<div class="container-fluid">
 <div class="row">
  @include('components.siderbar_panelcontrol')
  <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
   <div class="table-responsive mt-5">
    <div>
     <h2> <i class="bi bi-backpack4-fill "></i>&nbsp Inventario</h2>
    </div>

    <div class="btn-group ml-auto " role="group" aria-label="Basic example">
     <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#staticBackdrop1"> <i class="bi bi-clipboard-plus"></i> Nuevo Material</button>
     <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#staticBackdrop2"> <i class="bi bi-clipboard-plus"></i> Nuevo Almacen</button>
     <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#staticBackdrop3"> <i class="bi bi-clipboard-plus"></i> Nuevo Proveedor </button>
    </div>
    <div class="modal fade" id="staticBackdrop1" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
     <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
       <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">Registro de Material</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
       </div>
       <div class="modal-body">
        @include('components.form--materiales')
       </div>
      </div>
     </div>
    </div>
    <div class="modal fade" id="staticBackdrop2" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
     <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
       <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">Registro de Almacen</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
       </div>
       <div class="modal-body">
        @include('components.form--almacenes')
       </div>
      </div>
     </div>
    </div>
    <div class="modal fade" id="staticBackdrop3" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
     <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
       <div class="modal-header">
        <h1 class="modal-title fs-5" id="staticBackdropLabel">Registro de proveedores</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
       </div>
       <div class="modal-body">
        @include('components.form-proveedor')
       </div>
      </div>
     </div>
    </div>



    <div class="modal fade" id="modalRegistrarSalida" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modalRegistrarSalidaLabel" aria-hidden="true">
     <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
       <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="modalRegistrarSalidaLabel"> Registrar Salida de Material</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
       </div>
       <div class="modal-body">
        {{-- Aqu铆 incluiremos el formulario de salida --}}
        @include('components.form-movimientos-salida')
       </div>
      </div>
     </div>
    </div>


    <table data-toggle="table" class="table table-striped table-hover" data-search="true" data-sort-stable="true" data-pagination="true">
     <thead>
      <tr>
       <th data-sortable="true">Material</th>
       <th data-sortable="true">Descripci贸n</th>
       <th data-sortable="true">Cantidad Disponible</th>
       <th data-sortable="true">Almac茅n</th>
       <th data-sortable="true">Ubicaci贸n F铆sica</th>
       <th>Acciones</th>
      </tr>
     </thead>
     <tbody class="table-group-divider">
      {{--
      El controlador est谩 pasando una colecci贸n llamada $inventarioItems, 
      la cual ya tiene las relaciones 'material' y 'almacen' cargadas (Eager Loading).
    --}}
      @forelse ($inventario as $item)
      <tr>
       {{-- Uso directo de las relaciones de Eloquent --}}
       <td>{{ $item->material->nombre ?? 'N/A' }}</td>
       <td>{{ $item->material->descripcion ?? 'N/A' }}</td>
       <td>{{ $item->cantidad_actual }} {{ $item->unidad_medida }}</td>
       <td>{{ $item->almacen->nombre ?? 'N/A' }}</td>
       <td>{{ $item->almacen->direccion ?? 'N/A' }}</td>
       <td>
        {{-- Usar botones con clases de Bootstrap para mejor estilo y feedback --}}

        {{-- ... Otros botones (Nuevo Material, Almac茅n, Proveedor) ... --}}

        {{-- Bot贸n para abrir el nuevo modal de salida --}}
        <button type="button"
         class="btn btn-danger"
         data-bs-toggle="modal"
         data-bs-target="#modalRegistrarSalida"
         data-material-id="{{ $item->id_material }}"
         data-almacen-id="{{ $item->id_almacen }}"
         data-inventario-key="{{ $item->id_material }}-{{ $item->id_almacen }}"
         title="Registrar Salida">
         <i class="bi bi-truck"></i>
        </button>

        <button class="btn btn-sm btn-warning" title="Editar"><i class="bi bi-pencil"></i></button>
        {{-- Usar un formulario para la acci贸n DELETE --}}
        <form method="POST" action="{{ asset('inventario.destroy', $item->id) }}" style="display:inline;">
         @csrf
         @method('DELETE')
         <button type="submit" class="btn btn-sm btn-danger" title="Eliminar" onclick="return confirm('驴Confirmar eliminaci贸n?');">
          <i class="bi bi-eraser-fill"></i>
         </button>
        </form>
       </td>
      </tr>
      @empty
      <tr>
       {{-- Mensaje si el inventario est谩 vac铆o --}}
       <td colspan="6" class="text-center py-4">
        <i class="bi bi-info-circle"></i> No hay elementos registrados en el inventario.
       </td>
      </tr>
      @endforelse
     </tbody>
    </table>
   </DIV>
  </main>
 </div>
</div>
<script
 src="https://cdn.jsdelivr.net/npm/chart.js@4.3.2/dist/chart.umd.js"
 integrity="sha384-eI7PSr3L1XLISH8JdDII5YN/njoSsxfbrkCTnJrzXt+ENP5MOVBxD+l6sEG4zoLp"
 crossorigin="anonymous"
 class="astro-vvvwv3sm"></script>
<script src="dashboard.js" class="astro-vvvwv3sm"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // ... (Tu script existente de filtrado de almacenes va aqu铆) ...

    // --- L贸gica de Auto-relleno al Abrir el Modal ---

    const modalSalida = document.getElementById('modalSalidaMaterial'); 

    // 1. Verificar si el modal existe
    if (!modalSalida) return;

    // Escucha el evento que se dispara ANTES de que el modal se muestre
    modalSalida.addEventListener('show.bs.modal', function (event) {
      // El bot贸n que activ贸 el modal
      const button = event.relatedTarget; 

      // Obtener los datos del bot贸n
      const materialId = button.getAttribute('data-material-id');
      const almacenId = button.getAttribute('data-almacen-id');
      const inventarioKey = button.getAttribute('data-inventario-key'); // Ej: "5-1"

      // Elementos del formulario
      const selectAlmacen = document.getElementById('id_almacen1');
      const selectMaterial = document.getElementById('materiales1');
      
      // 2. Rellenar los campos del formulario
      
      if (almacenId) {
        // A. Seleccionar el almac茅n de origen
        selectAlmacen.value = almacenId;
        
        // *IMPORTANTE*: Llamar a la funci贸n de filtrado existente.
        // Esta funci贸n mostrar谩 solo las opciones de material correctas.
        // Asumo que tu funci贸n 'filtrarMateriales' est谩 disponible globalmente.
        // Si est谩 dentro de tu DOMContentLoaded, haz la l贸gica de filtrado aqu铆.
        
        // --- L贸gica de Filtrado (Duplicada para seguridad si no es global) ---
        const opcionesMateriales = Array.from(selectMaterial.querySelectorAll('option'));
        opcionesMateriales.forEach(option => {
          if (!option.hasAttribute('data-almacen')) return;
          const almacenMaterial = option.getAttribute('data-almacen');
          if (almacenMaterial === almacenId) {
            option.hidden = false;
            option.disabled = false;
          } else {
            option.hidden = true;
            option.disabled = true;
          }
        });
        // --------------------------------------------------------------------

        // B. Seleccionar el material
        // Primero, seleccionamos la opci贸n por su ID de material
        selectMaterial.value = materialId;

        // C. Actualizar la cantidad disponible y los l铆mites del input
        // *IMPORTANTE*: Llamar a la funci贸n de l铆mites existente.
        // Asumo que tu funci贸n 'actualizarLimites' est谩 disponible globalmente.
        // Si no es global, copia y pega la l贸gica de 'actualizarLimites' aqu铆.
        
        // --- L贸gica de Actualizaci贸n de L铆mites (Copia de la funci贸n 'actualizarLimites') ---
        const datosInventario = @json($mapaInventario ?? []);
        const etiquetaCantidad = document.getElementById('cantidad_label');
        const inputCantidad = document.getElementById('cantidad_input');

        const selectedOption = selectMaterial.options[selectMaterial.selectedIndex];
        const info = datosInventario[inventarioKey] || { cantidad_actual: 0, unidad_medida: '' };

        const cantidad_actual = Math.max(0, Number(info.cantidad_actual) || 0);
        const unidad = info.unidad_medida || '';

        etiquetaCantidad.textContent = `Cantidad Disponible: (${cantidad_actual} ${unidad})`;
        inputCantidad.max = String(cantidad_actual);
        inputCantidad.value = ""; // Limpiar la cantidad para que el usuario la introduzca
        // ----------------------------------------------------------------------------------

      } else {
        // Si el bot贸n no ten铆a data-almacen-id, reseteamos el formulario
        selectAlmacen.value = "";
        selectMaterial.value = "";
      }
    });
    
    // ... (Tu script existente de filtrado de almacenes contin煤a aqu铆) ...

  });
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
      // Elementos del DOM
      const selectAlmacen = document.getElementById('id_almacen1');
      const selectMaterial = document.getElementById('materiales1');
      const opcionesMateriales = Array.from(selectMaterial.querySelectorAll('option'));
      const etiquetaCantidad = document.getElementById('cantidad_label');
      const inputCantidad = document.getElementById('cantidad_input');

      // Datos del inventario pasados desde el controlador (clave: material_id-almacen_id)
      // 
      const datosInventario = @json($mapaInventario);

      // --- L贸gica de Filtrado y Visibilidad ---
      function filtrarMateriales() {
        const almacenId = selectAlmacen.value;

        // 1. Resetear y deshabilitar el selector de material
        selectMaterial.value = "";
        actualizarLimites(); // Limpia la etiqueta de cantidad

        // 2. Iterar y mostrar/ocultar las opciones
        opcionesMateriales.forEach(option => {
          // Si es el placeholder o no tiene valor de almac茅n, lo ignoramos
          if (!option.hasAttribute('data-almacen')) return;

          const almacenMaterial = option.getAttribute('data-almacen');

          // Mostrar solo los materiales que coinciden con el almac茅n seleccionado
          if (almacenMaterial === almacenId) {
            option.hidden = false;
            option.disabled = false;
          } else {
            option.hidden = true;
            option.disabled = true;
          }
        });
      }

      // --- L贸gica de Cantidades y L铆mites ---
      function actualizarLimites() {
        const selectedOption = selectMaterial.options[selectMaterial.selectedIndex];

        // 1. Verificar si hay una opci贸n v谩lida seleccionada
        if (!selectedOption || !selectedOption.hasAttribute('data-key')) {
          etiquetaCantidad.textContent = 'Cantidad Disponible: (0)';
          inputCantidad.max = 0;
          inputCantidad.value = "";
          return;
        }

        // 2. Obtener la clave compuesta y la informaci贸n del inventario
        const dataKey = selectedOption.getAttribute('data-key'); // Ej: "1-5"
        const info = datosInventario[dataKey] || {
          cantidad_actual: 0,
          unidad_medida: ''
        };

        const cantidad_actual = Math.max(0, Number(info.cantidad_actual) || 0);
        const unidad = info.unidad_medida || '';

        // 3. Actualizar la etiqueta y el atributo 'max' del input
        etiquetaCantidad.textContent = `Cantidad Disponible: (${cantidad_actual} ${unidad})`;
        inputCantidad.max = String(cantidad_actual);

        // 4. Limpiar el input si la cantidad actual es 0 o menor
        if (cantidad_actual === 0) {
          inputCantidad.value = "";
        }

        // 5. Ajustar el 'maxlength' din谩micamente para la validaci贸n visual (opcional)
        const maxDigits = Math.max(1, String(cantidad_actual).length);
        inputCantidad.setAttribute('maxlength', String(maxDigits));
      }

      // --- Listeners y Validaci贸n ---
      selectAlmacen.addEventListener('change', filtrarMateriales);
      selectMaterial.addEventListener('change', actualizarLimites);

      inputCantidad.addEventListener('input', function() {
        // Evitar que el valor sea negativo
        if (Number(this.value) < 0) this.value = 1;

        // Restricci贸n: No exceder el stock disponible
        if (this.value !== '' && Number(this.value) > Number(this.max)) {
          this.value = String(this.max);
        }
      });

      // Inicio
      // Si ya hay un almac茅n seleccionado al cargar (ej: en edici贸n), filtramos.
      if (selectAlmacen.value) filtrarMateriales();
      else {
        // Si no hay almac茅n seleccionado, ocultamos todas las opciones de material
        opcionesMateriales.forEach(opt => {
          if (opt.value !== "") opt.hidden = true;
        });
      }
    });
  </script>